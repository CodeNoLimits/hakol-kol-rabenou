<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©couverte Automatique des Livres Breslov sur Sefaria</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: #f3f4f6;
        }
        h1 {
            color: #1e3a8a;
            text-align: center;
        }
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        .results {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .book-item {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        .book-item.success {
            border-color: #10b981;
            background: #d1fae5;
        }
        .book-item.error {
            border-color: #ef4444;
            background: #fee2e2;
        }
        .book-name {
            font-weight: bold;
            color: #1e3a8a;
            font-size: 18px;
            margin-bottom: 5px;
        }
        .book-hebrew {
            direction: rtl;
            font-size: 16px;
            color: #4b5563;
            margin: 5px 0;
        }
        .book-details {
            font-size: 14px;
            color: #6b7280;
            margin-top: 10px;
        }
        pre {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin-top: 20px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.ok {
            background: #10b981;
            color: white;
        }
        .status.error {
            background: #ef4444;
            color: white;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #6b7280;
        }
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>üîç D√©couverte Automatique des Livres Breslov</h1>
    <p style="text-align: center; color: #6b7280;">Syst√®me intelligent de d√©couverte des vrais noms sur Sefaria.org</p>
    
    <div class="controls">
        <button onclick="discoverAllBreslovBooks()">
            üöÄ D√©couvrir tous les livres Breslov
        </button>
        <button onclick="searchSefariaIndex()">
            üìö Scanner l'index complet Sefaria
        </button>
        <button onclick="generateCode()">
            üíª G√©n√©rer le code JavaScript
        </button>
    </div>
    
    <div id="results" class="results"></div>

    <script>
        const SEFARIA_API = 'https://www.sefaria.org/api';
        
        // Termes de recherche pour les livres Breslov
        const BRESLOV_SEARCH_TERMS = [
            'Likutei Moharan',
            'Likutey Moharan',
            'Sichot HaRan',
            'Sichot Haran',
            'Sefer HaMidot',
            'Sefer Hamidot',
            'Sipurei Maasiot',
            'Sipurei Maasiyot',
            "Rabbi Nachman's Stories",
            'Likutei Etzot',
            'Likutey Etzot',
            'Likutei Tefilot',
            'Likutey Tefilot',
            'Chayei Moharan',
            'Hayei Moharan',
            'Likutei Halakhot',
            'Likutey Halakhot'
        ];
        
        let discoveredBooks = [];
        
        async function discoverAllBreslovBooks() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>D√©couverte en cours...</p></div>';
            
            discoveredBooks = [];
            let html = '<h2>üìñ Livres Breslov d√©couverts:</h2>';
            
            for (const searchTerm of BRESLOV_SEARCH_TERMS) {
                html += `<p>üîç Recherche: <strong>${searchTerm}</strong>...</p>`;
                resultsDiv.innerHTML = html;
                
                const book = await discoverBook(searchTerm);
                
                if (book) {
                    discoveredBooks.push(book);
                    html += `
                        <div class="book-item success">
                            <div class="book-name">‚úÖ ${book.title}</div>
                            <div class="book-hebrew">${book.heTitle || 'N/A'}</div>
                            <div class="book-details">
                                <strong>Cat√©gories:</strong> ${book.categories ? book.categories.join(' > ') : 'N/A'}<br>
                                <strong>R√©f√©rence API:</strong> <code>${book.title}</code><br>
                                <strong>Sections:</strong> ${book.length || 'Unknown'}
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="book-item error">
                            <div class="book-name">‚ùå ${searchTerm}</div>
                            <div class="book-details">Livre non trouv√© sur Sefaria</div>
                        </div>
                    `;
                }
                
                resultsDiv.innerHTML = html;
            }
            
            html += `<h3>‚úÖ D√©couverte termin√©e! ${discoveredBooks.length} livres trouv√©s.</h3>`;
            resultsDiv.innerHTML = html;
        }
        
        async function discoverBook(searchTerm) {
            try {
                // M√©thode 1: API name
                const nameUrl = `${SEFARIA_API}/name/${encodeURIComponent(searchTerm)}`;
                const nameResponse = await fetch(nameUrl);
                
                if (nameResponse.ok) {
                    const nameData = await nameResponse.json();
                    if (nameData.is_ref === false && nameData.type === 'index') {
                        // C'est un livre, charger les d√©tails
                        const indexUrl = `${SEFARIA_API}/index/${encodeURIComponent(searchTerm)}`;
                        const indexResponse = await fetch(indexUrl);
                        if (indexResponse.ok) {
                            return await indexResponse.json();
                        }
                    }
                }
                
                // M√©thode 2: Essayer directement index
                const indexUrl = `${SEFARIA_API}/index/${encodeURIComponent(searchTerm)}`;
                const indexResponse = await fetch(indexUrl);
                if (indexResponse.ok) {
                    return await indexResponse.json();
                }
                
            } catch (e) {
                console.error('Error discovering:', searchTerm, e);
            }
            
            return null;
        }
        
        async function searchSefariaIndex() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Scan de l\'index Sefaria...</p></div>';
            
            try {
                const response = await fetch(`${SEFARIA_API}/index/`);
                const index = await response.json();
                
                let html = '<h2>üìö Index Sefaria complet</h2>';
                html += '<p>Recherche de "Breslov", "Nachman", "Moharan"...</p>';
                
                const breslovBooks = [];
                
                // Scanner toutes les cat√©gories
                for (const [category, books] of Object.entries(index)) {
                    if (Array.isArray(books)) {
                        for (const book of books) {
                            const title = book.title || book;
                            const searchText = JSON.stringify(book).toLowerCase();
                            
                            if (searchText.includes('breslov') || 
                                searchText.includes('nachman') || 
                                searchText.includes('moharan') ||
                                searchText.includes('rebbe nachman')) {
                                breslovBooks.push(book);
                            }
                        }
                    }
                }
                
                html += `<h3>‚úÖ ${breslovBooks.length} livres trouv√©s</h3>`;
                
                breslovBooks.forEach(book => {
                    html += `
                        <div class="book-item success">
                            <div class="book-name">${book.title || book}</div>
                            <div class="book-hebrew">${book.heTitle || ''}</div>
                            <div class="book-details">
                                ${JSON.stringify(book, null, 2)}
                            </div>
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = html;
                
            } catch (e) {
                resultsDiv.innerHTML = `<div class="book-item error">Erreur: ${e.message}</div>`;
            }
        }
        
        function generateCode() {
            if (discoveredBooks.length === 0) {
                alert('Lancez d\'abord la d√©couverte des livres!');
                return;
            }
            
            const code = `// Livres Breslov d√©couverts automatiquement sur Sefaria
const BRESLOV_TEXTS = [
${discoveredBooks.map(book => `    {
        name: '${book.title}',
        hebrewName: '${book.heTitle || book.title}',
        ref: '${book.title}',
        description: '${(book.categories || []).join(' - ')}',
        maxChapters: ${book.length || 100}
    }`).join(',\n')}
];`;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h2>üíª Code JavaScript g√©n√©r√©</h2>
                <p>Copiez ce code dans votre fichier sefaria.js:</p>
                <pre>${code}</pre>
                <button onclick="copyCode()">üìã Copier le code</button>
            `;
            
            window.generatedCode = code;
        }
        
        function copyCode() {
            navigator.clipboard.writeText(window.generatedCode);
            alert('‚úÖ Code copi√© dans le presse-papiers!');
        }
    </script>
</body>
</html>

