<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>üî• Test FINAL - Traduction Progressive</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        h1 { color: #4CAF50; text-align: center; }
        .verse {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .english {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            line-height: 1.6;
        }
        .french {
            background: #1e3a1e;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            line-height: 1.6;
            border-left: 3px solid #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 0;
            font-weight: bold;
        }
        button:hover { background: #45a049; }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px 0;
        }
        .badge-success { background: #4CAF50; }
        .badge-info { background: #2196F3; }
        .badge-warning { background: #ff9800; }
        .console {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üî• TRADUCTION PROGRESSIVE - VERSION QUI MARCHE</h1>
    
    <div class="console" id="console">Console de debug...</div>
    
    <div class="verse">
        <h3>üìñ Verset de Test (200 caract√®res)</h3>
        <div class="english" id="english-1">
            Rabbi Nachman of Breslov teaches that the essence of prayer is simplicity and honesty. 
            When you speak to God, speak from your heart in your own words. This is called Hitbodedut, 
            personal prayer in solitude.
        </div>
        <button onclick="translate(1)" id="btn-1">üá´üá∑ Traduire en fran√ßais</button>
        <div class="french" id="french-1" style="display: none;"></div>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');
        
        function log(msg) {
            console.log(msg);
            consoleDiv.innerHTML += msg + '<br>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        // MULTI-API avec fallback automatique
        const APIS = [
            {
                name: 'Gemini 1',
                key: 'AIzaSyDYfwXnw7dzCfULTw2pp-m0EvdJthzKQn4',
                translate: async (text, key) => {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Translate to French, only return translation:\n\n${text}` }] }],
                            generationConfig: { temperature: 0.1, maxOutputTokens: 1000 }
                        })
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                }
            },
            {
                name: 'Gemini 2',
                key: 'AIzaSyDlQT06-uHNnCFdaD5dm9iV_v6qRI8ob4M',
                translate: async (text, key) => {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Translate to French:\n${text}` }] }]
                        })
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                }
            },
            {
                name: 'MyMemory',
                key: null,
                translate: async (text) => {
                    if (text.length > 500) text = text.substring(0, 500);
                    const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|fr&de=contact@hakolkolrabenou.com`);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return data.responseData?.translatedText?.trim();
                }
            }
        ];
        
        window.translate = async function(verseNum) {
            const btn = document.getElementById(`btn-${verseNum}`);
            const frenchDiv = document.getElementById(`french-${verseNum}`);
            const englishDiv = document.getElementById(`english-${verseNum}`);
            
            const text = englishDiv.textContent.trim();
            
            btn.disabled = true;
            btn.textContent = '‚è≥ Traduction en cours...';
            log(`\nüîÑ Traduction de ${text.length} caract√®res...`);
            
            // Essayer chaque API dans l'ordre
            for (let i = 0; i < APIS.length; i++) {
                const api = APIS[i];
                log(`üîå Essai ${api.name}...`);
                
                try {
                    const translation = await api.translate(text, api.key);
                    
                    if (translation && translation !== text) {
                        frenchDiv.textContent = translation;
                        frenchDiv.style.display = 'block';
                        
                        btn.textContent = '‚úÖ Traduit !';
                        btn.style.background = '#4CAF50';
                        
                        log(`‚úÖ SUCC√àS avec ${api.name} !`);
                        log(`üìù Traduction: ${translation.substring(0, 100)}...`);
                        return;
                    } else {
                        log(`‚ö†Ô∏è ${api.name}: traduction invalide`);
                    }
                    
                } catch (error) {
                    log(`‚ùå ${api.name} √©chou√©: ${error.message}`);
                }
            }
            
            // Toutes les APIs ont √©chou√©
            log(`‚ùå √âCHEC TOTAL - Toutes les APIs ont √©chou√©`);
            btn.disabled = false;
            btn.textContent = '‚ö†Ô∏è R√©essayer';
            btn.style.background = '#f44336';
        }
        
        log('‚úÖ Syst√®me pr√™t - 3 APIs disponibles');
        log('üìå Gemini 1, Gemini 2, MyMemory');
    </script>
</body>
</html>

